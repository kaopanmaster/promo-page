<!doctype html>
<html lang="th">
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>โปรโมชัน</title>

<style>
  body{margin:0;background:#000;color:#fff;font-family:system-ui,sans-serif}
  .wrap{min-height:100dvh;display:grid;place-items:center;padding:16px}
  .card{width:min(460px,100%);background:rgba(20,20,20,.9);border-radius:16px;padding:16px}
  .hero{width:100%;border-radius:12px}
  .btn{display:block;width:100%;padding:14px 16px;margin-top:14px;border-radius:12px;border:0;font-weight:700}
  .btn-primary {
  background: linear-gradient(135deg, #14b866, #0f8a4b);
  color: #fff;
  border: none;
  border-radius: 6px;
  padding: 10px 20px;
  font-size: 16px;
  font-weight: 600;
  cursor: pointer;
  box-shadow: 0 4px 8px rgba(20, 184, 102, 0.4);
  transition: all 0.3s ease;
}

.btn-primary:hover {
  background: linear-gradient(135deg, #17d274, #0c6d3b);
  box-shadow: 0 6px 12px rgba(20, 184, 102, 0.6);
  transform: translateY(-2px);
}
 
  .muted{color:#cfcfcf;font-size:14px}
</style>

<body>
<div class="wrap">
  <div class="card">
    <img class="hero" src="https://tga168.ai/wp-content/uploads/2024/12/TGA168-Pronew-1-3-1024x1024.webp" alt="promo" />
    <p class="muted" style="margin:10px 6px 0">แชร์กิจกรรมตามกติกาเพื่อรับสิทธิ์</p>
    <button id="shareBtn" class="btn btn-primary">กดแชร์กิจกรรม</button>
  </div>
</div>

<!-- LIFF SDK -->
<script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
<script>
const LIFF_ID = "2008144040-YZrXRWvr"; // LIFF ของคุณ

// ---------- Flex (2 การ์ดแบบ Carousel) ----------
function flexCarousel() {
  return {
    type: "flex",
    altText: "โปรโมชัน TGA168",
    contents: {
      type: "carousel",
      contents: [
        // การ์ด 1
        {
          type: "bubble",
          size: "mega",
          hero: {
            type: "image",
            url: "https://tga168.ai/wp-content/uploads/2024/12/TGA168-Pronew-1-3-1024x1024.webp",
            size: "full",
            aspectMode: "cover",
            aspectRatio: "1:1"
          },
          body: {
            type: "box",
            layout: "vertical",
            spacing: "sm",
            contents: [
              { type: "text", text: "สมัครรับทันที 100", weight: "bold", size: "xl" },
              { type: "text", text: "ทำกติกาให้ครบ แล้วรับสิทธิ์ได้เลย", size: "sm", color: "#aaaaaa", wrap: true }
            ]
          },
          footer: {
            type: "box",
            layout: "vertical",
            spacing: "md",
            contents: [
              {
                type: "button",
                style: "primary",
                action: { type: "uri", label: "ร่วมกิจกรรม", uri: "https://liff.line.me/" + LIFF_ID }
              },
              {
                type: "button",
                style: "link",
                action: { type: "uri", label: "เข้าสู่ระบบ", uri: "https://up-api.buzz/register?partner_ref=seodomain" }
              }
            ]
          }
        },
        // การ์ด 2
        {
          type: "bubble",
          size: "mega",
          hero: {
            type: "image",
            url: "https://tga168.ai/wp-content/uploads/2024/12/TGA168-Pronew-4-2-1024x1024.webp",
            size: "full",
            aspectMode: "cover",
            aspectRatio: "1:1"
          },
          body: {
            type: "box",
            layout: "vertical",
            spacing: "sm",
            contents: [
              { type: "text", text: "BONUS TIME", weight: "bold", size: "xl" },
              { type: "text", text: "อัตราเข้าฟีเจอร์สูงขึ้นช่วงเวลาพิเศษ", size: "sm", color: "#aaaaaa", wrap: true }
            ]
          },
          footer: {
            type: "box",
            layout: "vertical",
            spacing: "md",
            contents: [
              {
                type: "button",
                style: "primary",
                action: { type: "uri", label: "ทางเข้าเล่น", uri: "https://up-api.buzz/register?partner_ref=seodomain" }
              },
              {
                type: "button",
                style: "link",
                action: { type: "uri", label: "สมัครสมาชิก", uri: "https://up-api.buzz/register?partner_ref=seodomain" }
              }
            ]
          }
        }
      ]
    }
  };
}

// ---------- Init + กันตายเรื่อง token ----------
async function ensureReady() {
  await liff.init({ liffId: LIFF_ID });

  if (!liff.isLoggedIn()) {            // ให้มี token เสมอ
    liff.login({ redirectUri: location.href });
    return false;
  }
  if (!liff.getAccessToken()) {        // กันเคส token ว่าง
    liff.logout();
    liff.login({ redirectUri: location.href });
    return false;
  }
  return true;
}

(async () => {
  const ok = await ensureReady();
  if (!ok) return;

  // ปุ่มแชร์
  document.getElementById('shareBtn').addEventListener('click', async () => {
    try {
      if (!liff.isInClient()) {
        // พาคนเปิดใน LINE อัตโนมัติ
        location.href = 'https://liff.line.me/' + LIFF_ID + location.search;
        return;
      }
      if (!liff.isApiAvailable('shareTargetPicker')) {
        alert('อุปกรณ์นี้ยังไม่รองรับการแชร์แบบเลือกห้อง');
        return;
      }
      const res = await liff.shareTargetPicker([ flexCarousel() ]);
      if (res) { alert('แชร์สำเร็จ'); liff.closeWindow(); }
    } catch (err) {
      alert('แชร์ไม่สำเร็จ: ' + err.message);
    }
  });
})();
</script>
</body>
</html>
